{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "505cc126_47b7c708",
        "filename": "src/tint/lang/spirv/writer/raise/var_for_dynamic_index.cc",
        "patchSetId": 1
      },
      "lineNbr": 178,
      "author": {
        "id": 1001737
      },
      "writtenOn": "2024-04-24T08:38:24Z",
      "side": 1,
      "message": "There\u0027s a big assumption here between `constant \u003d\u003d module-scope`, `non-constant \u003d\u003d function-scope`. I\u0027m not sure that\u0027ll always be the case (i.e. lets might become root-block things one day).\n\nI think you could just as easily express this logic as `if (source_object-\u003eBlock() \u003d\u003d ir.root_block) {`",
      "range": {
        "startLine": 178,
        "startChar": 16,
        "endLine": 178,
        "endChar": 55
      },
      "revId": "2a3c046844b2d69657d6750f915617a5955bb3de",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9e87395e_bf147b91",
        "filename": "src/tint/lang/spirv/writer/raise/var_for_dynamic_index.cc",
        "patchSetId": 1
      },
      "lineNbr": 178,
      "author": {
        "id": 1002241
      },
      "writtenOn": "2024-04-24T16:28:29Z",
      "side": 1,
      "message": "The logic isn\u0027t quite that easy. Constants are not instruction results, they just exist. So they don\u0027t have a block. Function parameters don\u0027t have blocks either.\n\nAside from that, the partial access logic above here would also be broken if we had a value declaration at module-scope, since it would try to insert an `access` instruction into the root block. So there\u0027s more changes needed to support that case then just picking the right place to declare the variable.\n\nI\u0027ve added an assertion to explicitly guard against that hypothetical future. I imagine if we ever do support module-scope lets, we\u0027d handle it here by just folding them away and using their (presumably constant) initializer as the source.",
      "parentUuid": "505cc126_47b7c708",
      "range": {
        "startLine": 178,
        "startChar": 16,
        "endLine": 178,
        "endChar": 55
      },
      "revId": "2a3c046844b2d69657d6750f915617a5955bb3de",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    }
  ]
}