{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "688c1b5c_8cf6f100",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 1002421
      },
      "writtenOn": "2022-08-22T10:54:35Z",
      "side": 1,
      "message": "I thought you were going to use the `AddSpirvBlockAttribute` for this?\nWas there an issue with using this transform?",
      "revId": "0541865251969d284bbad192bd4843ea9b280b25",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8f78f433_245a8024",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 1000024
      },
      "writtenOn": "2022-08-22T18:47:40Z",
      "side": 1,
      "message": "I looked at it, but TBH I don\u0027t understand the need for special handling of nested structs. I\u0027m probably missing something, but this simple CL handles all the test cases. Are there cases not covered by existing tests?",
      "parentUuid": "688c1b5c_8cf6f100",
      "revId": "0541865251969d284bbad192bd4843ea9b280b25",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ed7d11bb_b8b29192",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 1001737
      },
      "writtenOn": "2022-08-22T19:11:49Z",
      "side": 1,
      "message": "The handling is to only split the structure if it is needed. If there\u0027s no other use of the structure, aside from direct use from storage, uniform or pushconstant, then it isn\u0027t split.\n\n\u003e Are there cases not covered by existing tests?\n\nPush constants. Everything else appears to work - however, I\u0027d rather we unified this logic (by using the existing transform) instead of adding a complexity to one backend, and having two solutions to maintain.",
      "parentUuid": "8f78f433_245a8024",
      "revId": "0541865251969d284bbad192bd4843ea9b280b25",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "50aedf4f_52340441",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 1000024
      },
      "writtenOn": "2022-08-22T22:40:27Z",
      "side": 1,
      "message": "OK, so it turns out James already added the AddSpirvBlockAttribute transform to the GLSL backend here: https://dawn-review.googlesource.com/c/tint/+/76164, in order to turn wrap all non-struct interface variables in structs.\n\nAFAICT, the only actual use of SpirvBlockAttribute in the SPIR-V backend is to decorate structs used as memory buffers with SpvDecorationBlock. I suppose I could use it determine when to emit an interface block, but I don\u0027t see how that helps.",
      "parentUuid": "ed7d11bb_b8b29192",
      "revId": "0541865251969d284bbad192bd4843ea9b280b25",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b3e72752_35b14d09",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 11
      },
      "lineNbr": 0,
      "author": {
        "id": 1002421
      },
      "writtenOn": "2022-08-23T11:41:33Z",
      "side": 1,
      "message": "It decorates buffers, but more importantly, it does the wrapping of structures if they are used as a storage, uniform or push_buffer *and* that structure is used by another type.\n\nIt\u0027s not (currently) a perfect match for GLSL, as there is one subtle difference between SPIRV and GLSL\u0027s needs for wrapping:\n* SPIR-V can happily use a `Block` decorated structure as a regular (`private`, `function`) structure.\n* GLSL cannot use an interface block as a regular structure.\n\n\nSo the particular case that this CL is addressing wouldn\u0027t currently be handled by the `AddSpirvBlockAttribute` transform:\n\n```\nstruct S { i : i32 }\n@group(0) binding(0) var\u003cuniform\u003e u : S;\n\nfn f() {\n  let l \u003d u; // Note that we\u0027re loading the whole \u0027S\u0027 structure, not a member access.\n}\n```\n\nHowever, making the `AddSpirvBlockAttribute` transform handle this is trivial. I\u0027ve pushed a PoC at:\nhttps://dawn-review.googlesource.com/c/dawn/+/100141\n\n\nI think using this transform is preferable, as it keeps the complexity out of the writer, and means we can properly isolate and test these code-transformations. It also means bug fixes can be made to a single place, instead of having to juggle a bunch of different implementations.",
      "parentUuid": "50aedf4f_52340441",
      "revId": "0541865251969d284bbad192bd4843ea9b280b25",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    }
  ],
  "submitRequirementResults": [
    {
      "submitRequirement": {
        "name": "Code-Review",
        "description": {
          "value": "At least one maximum vote for label \u0027Code-Review\u0027 is required"
        },
        "applicabilityExpression": {},
        "submittabilityExpression": {
          "expressionString": "label:Code-Review\u003dMAX,user\u003dnon_uploader AND -label:Code-Review\u003dMIN"
        },
        "overrideExpression": {
          "value": {
            "expressionString": "label:Bot-Commit\u003d+1 AND -label:Code-Review\u003dMIN"
          }
        },
        "allowOverrideInChildProjects": true
      },
      "applicabilityExpressionResult": {},
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"label:Code-Review=MAX,user=non_uploader AND -label:Code-Review=MIN"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["label:Code-Review=MAX,user=non_uploader","label:Code-Review=MIN"]}
      },
      "overrideExpressionResult": {
        "value": {"expression":{"expressionString":"label:Bot-Commit=+1 AND -label:Code-Review=MIN"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["label:Bot-Commit=+1","label:Code-Review=MIN"]}
      },
      "patchSetCommitId": "0541865251969d284bbad192bd4843ea9b280b25",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    },
    {
      "submitRequirement": {
        "name": "Kokoro",
        "description": {
          "value": "A maximum vote is required for the Kokoro label. A minimum vote is blocking."
        },
        "applicabilityExpression": {},
        "submittabilityExpression": {
          "expressionString": "label:Kokoro\u003dMAX AND -label:Kokoro\u003dMIN"
        },
        "overrideExpression": {
          "value": {
            "expressionString": "uploader:dawn-autoroll@skia-public.iam.gserviceaccount.com OR uploader:chrome-automated-expectation@chops-service-accounts.iam.gserviceaccount.com"
          }
        },
        "allowOverrideInChildProjects": true
      },
      "applicabilityExpressionResult": {},
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"label:Kokoro=MAX AND -label:Kokoro=MIN"},"status":"PASS","errorMessage":{"value":null},"passingAtoms":["label:Kokoro=MAX"],"failingAtoms":["label:Kokoro=MIN"]}
      },
      "overrideExpressionResult": {
        "value": {"expression":{"expressionString":"uploader:dawn-autoroll@skia-public.iam.gserviceaccount.com OR uploader:chrome-automated-expectation@chops-service-accounts.iam.gserviceaccount.com"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["uploader:dawn-autoroll@skia-public.iam.gserviceaccount.com","uploader:chrome-automated-expectation@chops-service-accounts.iam.gserviceaccount.com"]}
      },
      "patchSetCommitId": "0541865251969d284bbad192bd4843ea9b280b25",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    },
    {
      "submitRequirement": {
        "name": "Review-Enforcement",
        "description": {
          "value": "Two Google employees must approve the change. Uploading the change or voting positively on Code-Review count as approval."
        },
        "applicabilityExpression": {
          "value": {
            "expressionString": "is:review-enforced_gerrit"
          }
        },
        "submittabilityExpression": {
          "expressionString": "is:review-enforcement-satisfied_gerrit"
        },
        "overrideExpression": {},
        "allowOverrideInChildProjects": false
      },
      "applicabilityExpressionResult": {
        "value": {"expression":{"expressionString":"is:review-enforced_gerrit"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["is:review-enforced_gerrit"]}
      },
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"is:review-enforcement-satisfied_gerrit"},"status":"NOT_EVALUATED","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":[]}
      },
      "overrideExpressionResult": {},
      "patchSetCommitId": "0541865251969d284bbad192bd4843ea9b280b25",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    }
  ]
}