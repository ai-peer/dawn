{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "ac060493_ea4e5e70",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 43
      },
      "lineNbr": 0,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-04-11T11:51:04Z",
      "side": 1,
      "message": "No additional comments. LGTM",
      "revId": "6e46a4f2cfb073054bf427437e66a0b385f49aa5",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f73f2fa3_8979ee2f",
        "filename": "generator/dawn_json_generator.py",
        "patchSetId": 43
      },
      "lineNbr": 605,
      "author": {
        "id": 1000032
      },
      "writtenOn": "2023-03-24T20:07:46Z",
      "side": 1,
      "message": "how is this different from the existing `proto_generated_commands`?",
      "range": {
        "startLine": 600,
        "startChar": 1,
        "endLine": 605,
        "endChar": 36
      },
      "revId": "6e46a4f2cfb073054bf427437e66a0b385f49aa5",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8a5f90d4_0b650c48",
        "filename": "generator/dawn_json_generator.py",
        "patchSetId": 43
      },
      "lineNbr": 605,
      "author": {
        "id": 1003291
      },
      "writtenOn": "2023-05-02T03:24:35Z",
      "side": 1,
      "message": "Good catch, it\u0027s not!",
      "parentUuid": "f73f2fa3_8979ee2f",
      "range": {
        "startLine": 600,
        "startChar": 1,
        "endLine": 605,
        "endChar": 36
      },
      "revId": "6e46a4f2cfb073054bf427437e66a0b385f49aa5",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f48e8574_4f764ccd",
        "filename": "generator/dawn_json_generator.py",
        "patchSetId": 43
      },
      "lineNbr": 611,
      "author": {
        "id": 1000032
      },
      "writtenOn": "2023-03-24T20:07:46Z",
      "side": 1,
      "message": "I don\u0027t see where this is used",
      "range": {
        "startLine": 611,
        "startChar": 0,
        "endLine": 611,
        "endChar": 44
      },
      "revId": "6e46a4f2cfb073054bf427437e66a0b385f49aa5",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ada3ccfb_3d6714de",
        "filename": "generator/dawn_json_generator.py",
        "patchSetId": 43
      },
      "lineNbr": 611,
      "author": {
        "id": 1003291
      },
      "writtenOn": "2023-05-02T03:24:35Z",
      "side": 1,
      "message": "Good catch, and my bad I moved the bits of code into the next commit \"4/N\u0027 after a previous code review and forgot to take this line out of this CL.",
      "parentUuid": "f48e8574_4f764ccd",
      "range": {
        "startLine": 611,
        "startChar": 0,
        "endLine": 611,
        "endChar": 44
      },
      "revId": "6e46a4f2cfb073054bf427437e66a0b385f49aa5",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "09fd45f2_535b2fcb",
        "filename": "generator/templates/dawn/fuzzers/lpmfuzz/dawn_lpm.proto",
        "patchSetId": 43
      },
      "lineNbr": 153,
      "author": {
        "id": 1000032
      },
      "writtenOn": "2023-03-24T20:07:46Z",
      "side": 1,
      "message": "nit: possible to have these in a separate .proto file? or like #include another .proto? It\u0027s not a dealbreaker, but it\u0027s nice to have manually-written things not be in the templates/ directory.",
      "range": {
        "startLine": 144,
        "startChar": 0,
        "endLine": 153,
        "endChar": 0
      },
      "revId": "6e46a4f2cfb073054bf427437e66a0b385f49aa5",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "502e63d2_84b43b13",
        "filename": "generator/templates/dawn/fuzzers/lpmfuzz/dawn_lpm.proto",
        "patchSetId": 43
      },
      "lineNbr": 153,
      "author": {
        "id": 1003291
      },
      "writtenOn": "2023-05-02T03:24:35Z",
      "side": 1,
      "message": "We originally had this in a separate proto file early on in this CL chain, however we wanted to generate `ObjectType` (which DestroyObject a customcommand depends on).\n\nThe main issue is that protobuf doesn\u0027t support circular dependencies. So if we wanted to go down that route of keeping the custom `.proto` file in-tree we\u0027d need a generated file that depends on a custom written file which depends on a generate file which might not be a path we want to go down. However, I\u0027m okay going back to this or maybe it would be better to break out dawn_lpm_custom.proto into generator/templates and not combine everything in this file? I couldn\u0027t find a _nice_ solution to this.\n\nWhat do you think the best path forward is?",
      "parentUuid": "09fd45f2_535b2fcb",
      "range": {
        "startLine": 144,
        "startChar": 0,
        "endLine": 153,
        "endChar": 0
      },
      "revId": "6e46a4f2cfb073054bf427437e66a0b385f49aa5",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cc76d26c_320bd17f",
        "filename": "generator/templates/dawn/fuzzers/lpmfuzz/dawn_lpm.proto",
        "patchSetId": 43
      },
      "lineNbr": 153,
      "author": {
        "id": 1000032
      },
      "writtenOn": "2023-05-02T04:06:24Z",
      "side": 1,
      "message": "\u003e a generated file that depends on a custom written file which depends on a generated file\n\nto clarify, we would have dependencies:\n - (generated) dawn_lpm.proto -\u003e (generated) dawn_objects_types_lpm.proto\n - (generated) dawn_lpm.proto -\u003e (custom) dawn_custom_lpm.proto -\u003e (generated) dawn_objects_types_lpm.proto\n\n\u003e better to break out dawn_lpm_custom.proto into generator/templates and not combine everything in this file\n\nnot sure what you mean by this\n\n\noverall, having dawn_lpm.proto depend on dawn_custom_lpm.proto depend on dawn_objects_types_lpm.proto doesn\u0027t seem so bad to me, but maybe I\u0027m not seeing something that you\u0027re considering.\n\nI could see that dawn_lpm.proto depend on dawn_custom_lpm.proto could be problematic if the generator is relying on some non-trivial behavior in the custom proto file, but in this scenario, it\u0027s more like they\u0027re being \"concatenated\".\nActually - that\u0027s another way we could shape it. The generator could read in the custom proto file and paste its contents directly into the generated one?",
      "parentUuid": "502e63d2_84b43b13",
      "range": {
        "startLine": 144,
        "startChar": 0,
        "endLine": 153,
        "endChar": 0
      },
      "revId": "6e46a4f2cfb073054bf427437e66a0b385f49aa5",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cc75a94c_81642a2e",
        "filename": "generator/templates/dawn/fuzzers/lpmfuzz/dawn_lpm.proto",
        "patchSetId": 43
      },
      "lineNbr": 153,
      "author": {
        "id": 1003291
      },
      "writtenOn": "2023-05-02T17:22:36Z",
      "side": 1,
      "message": "Yeah the dependencies would be:\n\n(generated) dawn_lpm.proto -\u003e (generated) dawn_objects_types_lpm.proto\n(generated) dawn_lpm.proto -\u003e (custom) dawn_custom_lpm.proto -\u003e (generated) dawn_objects_types_lpm.proto\n\n\n\u003e better to break out dawn_lpm_custom.proto into generator/templates and not combine everything in this file\n\nAh sorry that was confusingly worded. I meant that it seemed better to add the contents of dawn_custom_lpm.proto to dawn_lpm.proto than to do `(generated) dawn_lpm.proto -\u003e (custom) dawn_custom_lpm.proto -\u003e (generated) dawn_objects_types_lpm.proto`.\n\n\u003e overall, having dawn_lpm.proto depend on dawn_custom_lpm.proto depend on dawn_objects_types_lpm.proto doesn\u0027t seem so bad to me, but maybe I\u0027m not seeing something that you\u0027re considering.\n\nThe main issue is I\u0027m not sure how to import a generated protobuf file from an in-tree protobuf file (for `(custom) dawn_custom_lpm.proto -\u003e (generated) dawn_objects_types_lpm.proto`). I think we\u0027re the first user who has needed to do this.\n\nFor example, this works:\n```\nsyntax \u003d \"proto2\";\npackage fuzzing;\n\nimport \"out/libfuzzer/gen/third_party/dawn/src/dawn/fuzzers/lpmfuzz/dawn_object_types_lpm_autogen.proto\"\n\nmessage DeviceCreateShaderModule {\n    required uint32 self \u003d 1;\n}\n\nmessage DestroyObject {\n    required ObjectType objectType \u003d 1;\n    required uint32 objectId \u003d 2;\n}\n```\n\nThe protoc command that is executed is:\n`python3 ../../tools/protoc_wrapper/protoc_wrapper.py out/libfuzzer/gen/third_party/dawn/src/dawn/fuzzers/lpmfuzz/dawn_lpm_autogen.proto out/libfuzzer/gen/third_party/dawn/src/dawn/fuzzers/lpmfuzz/dawn_object_types_lpm_autogen.proto third_party/dawn/src/dawn/fuzzers/lpmfuzz/dawn_custom_lpm.proto --protoc ./protoc --proto-in-dir ../../ --cc-out-dir gen/ --py-out-dir pyproto/\n`",
      "parentUuid": "cc76d26c_320bd17f",
      "range": {
        "startLine": 144,
        "startChar": 0,
        "endLine": 153,
        "endChar": 0
      },
      "revId": "6e46a4f2cfb073054bf427437e66a0b385f49aa5",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6c40422b_f2dff828",
        "filename": "generator/templates/dawn/fuzzers/lpmfuzz/dawn_lpm.proto",
        "patchSetId": 43
      },
      "lineNbr": 153,
      "author": {
        "id": 1000032
      },
      "writtenOn": "2023-05-02T17:28:46Z",
      "side": 1,
      "message": "ah I see..\n\n\u003e I meant that it seemed better to add the contents of dawn_custom_lpm.proto to dawn_lpm.proto\n\nso just \"paste\" the contents into it at generation time? that would be ok IMO",
      "parentUuid": "cc75a94c_81642a2e",
      "range": {
        "startLine": 144,
        "startChar": 0,
        "endLine": 153,
        "endChar": 0
      },
      "revId": "6e46a4f2cfb073054bf427437e66a0b385f49aa5",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5f29c12c_6f7c8fd9",
        "filename": "generator/templates/dawn/fuzzers/lpmfuzz/dawn_lpm.proto",
        "patchSetId": 43
      },
      "lineNbr": 153,
      "author": {
        "id": 1003291
      },
      "writtenOn": "2023-05-02T19:11:56Z",
      "side": 1,
      "message": "I was able to figure out how to get this to build without the need for pasting. Let me know what you think.",
      "parentUuid": "6c40422b_f2dff828",
      "range": {
        "startLine": 144,
        "startChar": 0,
        "endLine": 153,
        "endChar": 0
      },
      "revId": "6e46a4f2cfb073054bf427437e66a0b385f49aa5",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c58ed273_6f2e54e6",
        "filename": "generator/templates/dawn/fuzzers/lpmfuzz/dawn_lpm.proto",
        "patchSetId": 43
      },
      "lineNbr": 153,
      "author": {
        "id": 1003291
      },
      "writtenOn": "2023-05-02T19:35:18Z",
      "side": 1,
      "message": "To get around this I copy the dawn_custom_lpm.proto file to the `gen` directory and set proto_in_file\u003d\"$root_dir/gen\" as well.",
      "parentUuid": "5f29c12c_6f7c8fd9",
      "range": {
        "startLine": 144,
        "startChar": 0,
        "endLine": 153,
        "endChar": 0
      },
      "revId": "6e46a4f2cfb073054bf427437e66a0b385f49aa5",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    }
  ]
}