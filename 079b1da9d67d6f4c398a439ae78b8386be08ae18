{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "c51b9f30_aeec0627",
        "filename": "src/dawn/native/Buffer.h",
        "patchSetId": 21
      },
      "lineNbr": 76,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-01-20T11:07:18Z",
      "side": 1,
      "message": "This is no longer a setter. Maybe rename to MarkUsedInPendingCommands() ?",
      "range": {
        "startLine": 76,
        "startChar": 9,
        "endLine": 76,
        "endChar": 27
      },
      "revId": "079b1da9d67d6f4c398a439ae78b8386be08ae18",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a123c997_b2a9f430",
        "filename": "src/dawn/native/Buffer.h",
        "patchSetId": 21
      },
      "lineNbr": 76,
      "author": {
        "id": 1002331
      },
      "writtenOn": "2023-01-20T17:34:50Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c51b9f30_aeec0627",
      "range": {
        "startLine": 76,
        "startChar": 9,
        "endLine": 76,
        "endChar": 27
      },
      "revId": "079b1da9d67d6f4c398a439ae78b8386be08ae18",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6fa1d939_806878c6",
        "filename": "src/dawn/native/vulkan/BufferVk.cpp",
        "patchSetId": 21
      },
      "lineNbr": 254,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-01-20T11:07:18Z",
      "side": 1,
      "message": "[1] Even if the buffer can be reused without barriers, we should still tag it as used, since it is used by an operation on the GPU.",
      "range": {
        "startLine": 254,
        "startChar": 8,
        "endLine": 254,
        "endChar": 26
      },
      "revId": "079b1da9d67d6f4c398a439ae78b8386be08ae18",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a19a7e69_0c008281",
        "filename": "src/dawn/native/vulkan/BufferVk.cpp",
        "patchSetId": 21
      },
      "lineNbr": 254,
      "author": {
        "id": 1002331
      },
      "writtenOn": "2023-01-20T11:29:57Z",
      "side": 1,
      "message": "This method could be called with MapRead and MapWrite. In that case, the buffer will be accessed by CPU, so always updating the last usage serial is wrong. I guess we may need to call SetLastUsageSerial() explicitly, where buffer is really used instead of putting SetLastUsageSerial() call in TransitionUsageNow() or TrackUsageAndGetResourceBarrier().",
      "parentUuid": "6fa1d939_806878c6",
      "range": {
        "startLine": 254,
        "startChar": 8,
        "endLine": 254,
        "endChar": 26
      },
      "revId": "079b1da9d67d6f4c398a439ae78b8386be08ae18",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b019c5ff_9e138b61",
        "filename": "src/dawn/native/vulkan/BufferVk.cpp",
        "patchSetId": 21
      },
      "lineNbr": 254,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-01-20T13:35:28Z",
      "side": 1,
      "message": "What about calling it only if usage is not one of the mappable usage?",
      "parentUuid": "a19a7e69_0c008281",
      "range": {
        "startLine": 254,
        "startChar": 8,
        "endLine": 254,
        "endChar": 26
      },
      "revId": "079b1da9d67d6f4c398a439ae78b8386be08ae18",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d86eb8e8_9d42c010",
        "filename": "src/dawn/native/vulkan/BufferVk.cpp",
        "patchSetId": 21
      },
      "lineNbr": 254,
      "author": {
        "id": 1002331
      },
      "writtenOn": "2023-01-20T14:27:51Z",
      "side": 1,
      "message": "If the method is called with map usage, but the last usage is not map usage, we will need to issue pipeline barrier for it. In that case, the last usage serial should be updated too. That is why I suggested to call `SetLastUsageSerial()` directly just before a buffer is used with any `VkCmd*` calls.",
      "parentUuid": "b019c5ff_9e138b61",
      "range": {
        "startLine": 254,
        "startChar": 8,
        "endLine": 254,
        "endChar": 26
      },
      "revId": "079b1da9d67d6f4c398a439ae78b8386be08ae18",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6d79aaf2_7808005e",
        "filename": "src/dawn/native/vulkan/BufferVk.cpp",
        "patchSetId": 21
      },
      "lineNbr": 254,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-01-20T15:23:09Z",
      "side": 1,
      "message": "So you\u0027re saying that if the previous usage was not on the GPU (like it was either never used or it was last used on the CPU) then we don\u0027t need a barrier?\n\nThat can be checked with if (isMappable \u0026\u0026 (newUsage \u0026 kMappableUsage) \u0026\u0026 !(lastUsage \u0026 kGPUUsages))\n\nIn general we should really try to keep logic for things like this in a single place to avoid forgetting to update them in the future. Barrier tracking is a state soup so it\u0027s important that it be in a single place and not spread out around the whole codebase.\n\nThere will be a lot of branches in that function but I\u0027m sure we\u0027ll eventually be able to optimize it quite a bit by pre-computing things like \"is this buffer mappable\", \"can the usage be none\" etc.",
      "parentUuid": "d86eb8e8_9d42c010",
      "range": {
        "startLine": 254,
        "startChar": 8,
        "endLine": 254,
        "endChar": 26
      },
      "revId": "079b1da9d67d6f4c398a439ae78b8386be08ae18",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2984f2be_b0b3aee5",
        "filename": "src/dawn/native/vulkan/BufferVk.cpp",
        "patchSetId": 21
      },
      "lineNbr": 254,
      "author": {
        "id": 1002331
      },
      "writtenOn": "2023-01-20T17:34:50Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6d79aaf2_7808005e",
      "range": {
        "startLine": 254,
        "startChar": 8,
        "endLine": 254,
        "endChar": 26
      },
      "revId": "079b1da9d67d6f4c398a439ae78b8386be08ae18",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e33c3dce_692fd0f2",
        "filename": "src/dawn/native/vulkan/BufferVk.cpp",
        "patchSetId": 21
      },
      "lineNbr": 261,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-01-20T11:07:18Z",
      "side": 1,
      "message": "u-u-u-nit: !(usage \u0026 kMapUsages), ditto above",
      "range": {
        "startLine": 261,
        "startChar": 26,
        "endLine": 261,
        "endChar": 51
      },
      "revId": "079b1da9d67d6f4c398a439ae78b8386be08ae18",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "aac16d67_6e07347f",
        "filename": "src/dawn/native/vulkan/BufferVk.cpp",
        "patchSetId": 21
      },
      "lineNbr": 261,
      "author": {
        "id": 1002331
      },
      "writtenOn": "2023-01-20T17:34:50Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e33c3dce_692fd0f2",
      "range": {
        "startLine": 261,
        "startChar": 26,
        "endLine": 261,
        "endChar": 51
      },
      "revId": "079b1da9d67d6f4c398a439ae78b8386be08ae18",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dd4b8ede_d07d45f0",
        "filename": "src/dawn/native/vulkan/CommandBufferVk.cpp",
        "patchSetId": 21
      },
      "lineNbr": 172,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-01-20T11:07:18Z",
      "side": 1,
      "message": "This shouldn\u0027t be necessary with [1]",
      "revId": "079b1da9d67d6f4c398a439ae78b8386be08ae18",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "22a3fcdd_ec045a1d",
        "filename": "src/dawn/native/vulkan/CommandBufferVk.cpp",
        "patchSetId": 21
      },
      "lineNbr": 172,
      "author": {
        "id": 1002331
      },
      "writtenOn": "2023-01-20T17:52:51Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "dd4b8ede_d07d45f0",
      "revId": "079b1da9d67d6f4c398a439ae78b8386be08ae18",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ea5fa43f_97beb060",
        "filename": "src/dawn/native/vulkan/CommandRecordingContext.h",
        "patchSetId": 21
      },
      "lineNbr": 52,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-01-20T11:07:18Z",
      "side": 1,
      "message": "nit: at the end of the submit actually.",
      "range": {
        "startLine": 52,
        "startChar": 14,
        "endLine": 52,
        "endChar": 29
      },
      "revId": "079b1da9d67d6f4c398a439ae78b8386be08ae18",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a6003bec_f68c4411",
        "filename": "src/dawn/native/vulkan/CommandRecordingContext.h",
        "patchSetId": 21
      },
      "lineNbr": 52,
      "author": {
        "id": 1002331
      },
      "writtenOn": "2023-01-20T17:34:50Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ea5fa43f_97beb060",
      "range": {
        "startLine": 52,
        "startChar": 14,
        "endLine": 52,
        "endChar": 29
      },
      "revId": "079b1da9d67d6f4c398a439ae78b8386be08ae18",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f1208ef3_a413539b",
        "filename": "src/dawn/native/vulkan/DeviceVk.cpp",
        "patchSetId": 21
      },
      "lineNbr": 324,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-01-20T11:07:18Z",
      "side": 1,
      "message": "Here the logic for the buffer eager transitions is split between BufferVk.cpp and here. To have all of the logic in the same place, this could just call buffer-\u003eTransitionEagerly(\u0026mRecordingContext) and the logic for transitioning mappable buffers put there.",
      "revId": "079b1da9d67d6f4c398a439ae78b8386be08ae18",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d50c59a7_2df5c50b",
        "filename": "src/dawn/native/vulkan/DeviceVk.cpp",
        "patchSetId": 21
      },
      "lineNbr": 324,
      "author": {
        "id": 1002331
      },
      "writtenOn": "2023-01-20T17:34:50Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f1208ef3_a413539b",
      "revId": "079b1da9d67d6f4c398a439ae78b8386be08ae18",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    }
  ]
}