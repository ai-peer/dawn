{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "b9fa36f4_accfecda",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000028
      },
      "writtenOn": "2022-07-12T03:07:15Z",
      "side": 1,
      "message": "PTAL\n\nI am not exactly sure about the correctness of CL theoretically. But the performance gain seems rather appealing. For the 7x7 Google meet sample(https://source.chromium.org/chromium/chromium/src/+/main:content/test/data/gpu/vc/webgpu_videos_mxn.html;l\u003d1?q\u003dwebgpu_videos\u0026sq\u003d\u0026ss\u003dchromium), the GPU usage can drop from 35% to 21% on my ADL ChromeOS device. I would really appreciate your perspective on this, Thanks!",
      "revId": "c9e208040b4af750317c56a76e5f81ac1c548e76",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9d364bd3_6d607e59",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000028
      },
      "writtenOn": "2022-07-12T03:14:59Z",
      "side": 1,
      "message": "The corresponding change required at chromium side is https://chromium-review.googlesource.com/c/chromium/src/+/3756645.",
      "parentUuid": "b9fa36f4_accfecda",
      "revId": "c9e208040b4af750317c56a76e5f81ac1c548e76",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7d15f122_8f21bb26",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2022-07-12T12:41:09Z",
      "side": 1,
      "message": "The perf difference is impressive and it is totally worth looking at optimizing this. However I don\u0027t think this CL is correct because if the user of Dawn starts reusing the SharedImage then we didn\u0027t make a memory barrier that prevents read from Dawn from happening after the writes of whoever is reusing the SharedImage.\n\nThat\u0027s why I think we need to keep the semaphore being exported but avoid the need for empty submits (and ideally avoid the need for having 49 different semaphores).\n\nThe problem here is actually very similar to this TODO: https://source.chromium.org/chromium/chromium/src/+/main:third_party/dawn/src/dawn/native/vulkan/SwapChainVk.cpp;drc\u003d7e74c218738e637d4e9fdaff9dd5c38ca92ed1c3;l\u003d566 We are making empty submissions just to do a memory barrier, when we could in most cases eagerly transition and signal semaphores.\n\nSo the idea would be to detect in \"HandleTransitionSpecialCases\" that the resource needs to be eagerly transitioned / have a semaphore associated with it. Then at the end of the submit we would insert the transitions / special semaphores and update the state of the texture. This way we might create too many semaphores but at least there is no extra submits.\n\nAs a second part we could then have some kind of RefCounted semaphore wrapper so that external resources can all share the same \"export semaphore\" such that we only create at most one per submit. WDYT?",
      "parentUuid": "9d364bd3_6d607e59",
      "revId": "c9e208040b4af750317c56a76e5f81ac1c548e76",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0458f4d1_dca3d9e0",
        "filename": "src/dawn/native/vulkan/TextureVk.cpp",
        "patchSetId": 1
      },
      "lineNbr": 871,
      "author": {
        "id": 1000028
      },
      "writtenOn": "2022-07-12T03:12:17Z",
      "side": 1,
      "message": "The thing that is actually at stake seems to be this submit. Doing this for the NV12 even without the barrier could lead to significant GPU usage increasing.",
      "range": {
        "startLine": 871,
        "startChar": 8,
        "endLine": 871,
        "endChar": 50
      },
      "revId": "c9e208040b4af750317c56a76e5f81ac1c548e76",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    }
  ]
}