{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "8ba4e786_54ab99a8",
        "filename": "src/dawn/native/d3d11/BindGroupTrackerD3D11.cpp",
        "patchSetId": 9
      },
      "lineNbr": 114,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-05-15T12:45:10Z",
      "side": 1,
      "message": "We probably only need to do this unbinding on compute passes which would be nice because the Apply() on render passes is hot code.\n\nAlso can you explain why this change was needed?",
      "revId": "6969942bd94aaa90aef6401ef983609633150873",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "45b471ac_0ad0ae04",
        "filename": "src/dawn/native/d3d11/BindGroupTrackerD3D11.cpp",
        "patchSetId": 9
      },
      "lineNbr": 114,
      "author": {
        "id": 1000028
      },
      "writtenOn": "2023-05-15T13:18:35Z",
      "side": 1,
      "message": "It\u0027s because that `mDirtyBindGroups` may have groups that are not in the `mLastAppliedPipelineLayout`. That may cause `UnApplyBindGroup` to run into Assert.",
      "parentUuid": "8ba4e786_54ab99a8",
      "revId": "6969942bd94aaa90aef6401ef983609633150873",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4c65d95d_971c4be0",
        "filename": "src/dawn/native/d3d11/BindGroupTrackerD3D11.cpp",
        "patchSetId": 9
      },
      "lineNbr": 114,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-05-15T13:48:36Z",
      "side": 1,
      "message": "Then maybe this could use InheritedGroupsMask: https://source.chromium.org/chromium/chromium/src/+/refs/heads/main:third_party/dawn/src/dawn/native/PipelineLayout.h;drc\u003d7857c62e3a2131ef6558ec984fb99a6d3ff35d79;l\u003d73\n\n```\n// Unset currently bound bindgroups that aren\u0027t inherited from the layout.\nBindGroupLayoutMask inheritedGroups \u003d mPipelineLayout-\u003eInheritedGroupMask(mLastAppliedPipelineLayout);\nfor (BindGroupIndex index : IterateBitSet(mDirtyBindGroups \u0026 ~inheritedGroupsMask))\n```\n\nOr maybe I\u0027m missing something. (this would both make the semantic of the code more understandable, and would UnApply less bindgroups overall).",
      "parentUuid": "45b471ac_0ad0ae04",
      "revId": "6969942bd94aaa90aef6401ef983609633150873",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e75dffd1_e6a6db4a",
        "filename": "src/dawn/native/d3d11/BindGroupTrackerD3D11.cpp",
        "patchSetId": 9
      },
      "lineNbr": 121,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-05-15T12:45:10Z",
      "side": 1,
      "message": "I think that this will not work as is. What if we have BG0 and BG1A and BG1B all with a UAV and do:\n\n```\nSetBindGroup(0, BG0)\nSetBindGroup(0, BG1A)\nDraw()\nSetBindGroup(0, BG1B)\nDraw()\n```\n\nThen in the second `Draw()` the call to apply will only iterate over `BG1A` and `mUAVs` will only contain a single UAV, when it should contain two.\n\nInstead, I think we could pre-compute in the pipeline layout the mask of BGLs that have a fragment/vertex UAV, then here do:\n\n```\nwgpu::BindGroupLayoutMask renderUAVMask \u003d pipeline-\u003eGet...();\nif (renderUAVMask !\u003d 0) {\n  stack_vector\u003cComPtr\u003cUAV\u003e, 4?\u003e uavs;\n  for (group in IterateBitSet(renderUAVMask)) {\n    Iterate the UAVs of the group and add them to the vector\n  }\n  \n  Call OMSetRenderTargetsAndUnorderedAccessViews\n}\n```\n\nCould we also have a test that would have caught this?",
      "revId": "6969942bd94aaa90aef6401ef983609633150873",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fb579235_c40f5ce3",
        "filename": "src/dawn/native/d3d11/BindGroupTrackerD3D11.cpp",
        "patchSetId": 9
      },
      "lineNbr": 121,
      "author": {
        "id": 1000028
      },
      "writtenOn": "2023-05-15T13:18:35Z",
      "side": 1,
      "message": "\u003e  when it should contain two.\nSorry, could you please explain this? If I understand the example correctly, `BG0` shouldn\u0027t in fact count.",
      "parentUuid": "e75dffd1_e6a6db4a",
      "revId": "6969942bd94aaa90aef6401ef983609633150873",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1f57d728_84580330",
        "filename": "src/dawn/native/d3d11/BindGroupTrackerD3D11.cpp",
        "patchSetId": 9
      },
      "lineNbr": 121,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-05-15T13:48:36Z",
      "side": 1,
      "message": "Whoops sorry my example was mistyped:\n\n```\nSetBindGroup(0, BG0)\nSetBindGroup(1, BG1A) // Changed to 1\nDraw()\nSetBindGroup(1, BG1B) // Changed to 1\nDraw()\n```\n\nIn the second draw `mUAVs` should be `[BG0, BG1B]` but it will only be `[BG1B]`.",
      "parentUuid": "fb579235_c40f5ce3",
      "revId": "6969942bd94aaa90aef6401ef983609633150873",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6adf0e52_55872224",
        "filename": "src/dawn/native/d3d11/BindGroupTrackerD3D11.cpp",
        "patchSetId": 9
      },
      "lineNbr": 128,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-05-15T12:45:10Z",
      "side": 1,
      "message": "nit: ASSERT",
      "range": {
        "startLine": 128,
        "startChar": 8,
        "endLine": 128,
        "endChar": 19
      },
      "revId": "6969942bd94aaa90aef6401ef983609633150873",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9d9104c5_5b62b0da",
        "filename": "src/dawn/native/d3d11/BindGroupTrackerD3D11.cpp",
        "patchSetId": 9
      },
      "lineNbr": 129,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-05-15T12:45:10Z",
      "side": 1,
      "message": "We should probably pre-compute this value somewhere, for example on the device, and reuse it. It would avoid some indirections and a branch.",
      "revId": "6969942bd94aaa90aef6401ef983609633150873",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "58ca299f_5a805e9d",
        "filename": "src/dawn/native/d3d11/BindGroupTrackerD3D11.cpp",
        "patchSetId": 9
      },
      "lineNbr": 211,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-05-15T12:45:10Z",
      "side": 1,
      "message": "nit: this could be an std::move() to avoid an extra ref-deref cycle for the ComPtr. Ditto in other places.",
      "range": {
        "startLine": 211,
        "startChar": 56,
        "endLine": 211,
        "endChar": 64
      },
      "revId": "6969942bd94aaa90aef6401ef983609633150873",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    }
  ]
}