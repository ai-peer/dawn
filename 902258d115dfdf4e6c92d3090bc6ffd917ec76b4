{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "ad75f559_99c27773",
        "filename": "src/dawn/native/vulkan/DeviceVk.cpp",
        "patchSetId": 1
      },
      "lineNbr": 264,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2022-07-25T13:25:17Z",
      "side": 1,
      "message": "[1]",
      "revId": "902258d115dfdf4e6c92d3090bc6ffd917ec76b4",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8cc11c15_35e939fd",
        "filename": "src/dawn/native/vulkan/TextureVk.cpp",
        "patchSetId": 1
      },
      "lineNbr": 829,
      "author": {
        "id": 1000028
      },
      "writtenOn": "2022-07-25T12:30:01Z",
      "side": 1,
      "message": "The problem here is that we are unable to ensure that there will a SubmitPendingCommands() afterward, which is right before the \u0027exportSemaphore\u0027 is used by clients.\n\nThe current implementation of WebGPU Canvas basically is like:\n  a) Chromium WebGPU: Disassociate a external texture(Canvas).\n  b) Chromium SI: runs \u0027ExportVulkanImage\u0027\n  c) Dawn: returns here with \u0027exportSemaphore\u0027.\n  d) Chromium Viz: Begin GL access to the texture whose \u0027exportSemaphore\u0027 may not be submitted yet.",
      "range": {
        "startLine": 825,
        "startChar": 1,
        "endLine": 829,
        "endChar": 14
      },
      "revId": "902258d115dfdf4e6c92d3090bc6ffd917ec76b4",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9b557218_14dbec17",
        "filename": "src/dawn/native/vulkan/TextureVk.cpp",
        "patchSetId": 1
      },
      "lineNbr": 829,
      "author": {
        "id": 1000028
      },
      "writtenOn": "2022-07-25T13:05:04Z",
      "side": 1,
      "message": "Another constraint is that vkspec requires that we can export a VkSemaphore only after it has been submitted.\n\nhttps://registry.khronos.org/vulkan/specs/1.3-extensions/html/vkspec.html#VUID-VkSemaphoreGetFdInfoKHR-handleType-01135\n\nVUID-VkSemaphoreGetFdInfoKHR-handleType-01135\nIf handleType refers to a handle type with copy payload transference semantics, semaphore must be signaled, or have an associated semaphore signal operation pending execution",
      "parentUuid": "8cc11c15_35e939fd",
      "range": {
        "startLine": 825,
        "startChar": 1,
        "endLine": 829,
        "endChar": 14
      },
      "revId": "902258d115dfdf4e6c92d3090bc6ffd917ec76b4",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "21303eb7_8d48aa49",
        "filename": "src/dawn/native/vulkan/TextureVk.cpp",
        "patchSetId": 1
      },
      "lineNbr": 829,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2022-07-25T13:08:05Z",
      "side": 1,
      "message": "Re: first comment: the point is that the export semaphores are created during the VkQueueSubmit that use this resource, so there is no need to make a submit afterwards.\n\nRe: second comment: in that case we could do an empty submit, or better, re-export (or never import) the FD used to import this resource into Dawn.",
      "parentUuid": "9b557218_14dbec17",
      "range": {
        "startLine": 825,
        "startChar": 1,
        "endLine": 829,
        "endChar": 14
      },
      "revId": "902258d115dfdf4e6c92d3090bc6ffd917ec76b4",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7402968f_20695bba",
        "filename": "src/dawn/native/vulkan/TextureVk.cpp",
        "patchSetId": 1
      },
      "lineNbr": 829,
      "author": {
        "id": 1000028
      },
      "writtenOn": "2022-07-25T13:22:49Z",
      "side": 1,
      "message": "\u003e Re: first comment: the point is that the export semaphores are created during the VkQueueSubmit that use this resource, so there is no need to make a submit afterwards.\n\nIIUC, the resource can be used by viz GL drivers also, where there is no VkQueueSubmit. I\u0027m kind of confused. Did you mean the export semaphores here, at runtime, must have been submitted? How is it ensured in this CL?",
      "parentUuid": "21303eb7_8d48aa49",
      "range": {
        "startLine": 825,
        "startChar": 1,
        "endLine": 829,
        "endChar": 14
      },
      "revId": "902258d115dfdf4e6c92d3090bc6ffd917ec76b4",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a340b715_b5bf80ed",
        "filename": "src/dawn/native/vulkan/TextureVk.cpp",
        "patchSetId": 1
      },
      "lineNbr": 829,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2022-07-25T13:25:17Z",
      "side": 1,
      "message": "The export semaphore is created and signaled at [1]",
      "parentUuid": "7402968f_20695bba",
      "range": {
        "startLine": 825,
        "startChar": 1,
        "endLine": 829,
        "endChar": 14
      },
      "revId": "902258d115dfdf4e6c92d3090bc6ffd917ec76b4",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c0ef2303_55113e9d",
        "filename": "src/dawn/native/vulkan/TextureVk.cpp",
        "patchSetId": 1
      },
      "lineNbr": 829,
      "author": {
        "id": 1000028
      },
      "writtenOn": "2022-07-25T13:36:10Z",
      "side": 1,
      "message": "Could that be to earlier?\nFor example:\n  a) ImportExternalTexture\n  b) Use the texture\n  c) tweak the transition, submit and export the semaphore\n  d) Use the same texture and do something else and submit\n  e) ExportExternalTexture.\nSo clients expect the semaphore after the second use rather than the first use. In this case they get the wrong export semaphore.",
      "parentUuid": "a340b715_b5bf80ed",
      "range": {
        "startLine": 825,
        "startChar": 1,
        "endLine": 829,
        "endChar": 14
      },
      "revId": "902258d115dfdf4e6c92d3090bc6ffd917ec76b4",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3a90d9e1_86b9df39",
        "filename": "src/dawn/native/vulkan/TextureVk.h",
        "patchSetId": 1
      },
      "lineNbr": 170,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2022-07-25T10:11:59Z",
      "side": 1,
      "message": "Of course this would require a new class that wraps imported/exported VkSemaphores instead of the service acting directly on VkSemaphore / ExternalSemaphoreHandle.",
      "revId": "902258d115dfdf4e6c92d3090bc6ffd917ec76b4",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    }
  ]
}