{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "4364e93b_0a85b1e0",
        "filename": "src/dawn/native/CommandEncoder.cpp",
        "patchSetId": 11
      },
      "lineNbr": 89,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-11-20T13:48:35Z",
      "side": 1,
      "message": "[1]",
      "revId": "32a6a867b6015502e011694997da8d4e18f8986b",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bafa6377_0a92b700",
        "filename": "src/dawn/native/CommandEncoder.cpp",
        "patchSetId": 11
      },
      "lineNbr": 185,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-11-20T13:48:35Z",
      "side": 1,
      "message": "nit: GetUsage()?",
      "range": {
        "startLine": 185,
        "startChar": 21,
        "endLine": 185,
        "endChar": 32
      },
      "revId": "32a6a867b6015502e011694997da8d4e18f8986b",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "cca25bc8_f6b9ac7c",
        "filename": "src/dawn/native/CommandEncoder.cpp",
        "patchSetId": 11
      },
      "lineNbr": 185,
      "author": {
        "id": 1000030
      },
      "writtenOn": "2023-11-22T09:37:42Z",
      "side": 1,
      "message": "Use AttachmentType instead.",
      "parentUuid": "bafa6377_0a92b700",
      "range": {
        "startLine": 185,
        "startChar": 21,
        "endLine": 185,
        "endChar": 32
      },
      "revId": "32a6a867b6015502e011694997da8d4e18f8986b",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "567813a6_4e14448c",
        "filename": "src/dawn/native/CommandEncoder.cpp",
        "patchSetId": 11
      },
      "lineNbr": 191,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-11-20T13:48:35Z",
      "side": 1,
      "message": "This doesn\u0027t work for attachments that are both render and storage attachment but that\u0027s minor.. We could fix this later with the TODO at [1].",
      "revId": "32a6a867b6015502e011694997da8d4e18f8986b",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "eb4b8107_33c017da",
        "filename": "src/dawn/native/CommandEncoder.cpp",
        "patchSetId": 11
      },
      "lineNbr": 191,
      "author": {
        "id": 1000030
      },
      "writtenOn": "2023-11-22T09:37:42Z",
      "side": 1,
      "message": "Use AttachmentType instead.",
      "parentUuid": "567813a6_4e14448c",
      "revId": "32a6a867b6015502e011694997da8d4e18f8986b",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8ef0254d_8a17b108",
        "filename": "src/dawn/native/CommandEncoder.cpp",
        "patchSetId": 11
      },
      "lineNbr": 195,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-11-20T13:48:35Z",
      "side": 1,
      "message": "nit: UNREACHABLE()?",
      "revId": "32a6a867b6015502e011694997da8d4e18f8986b",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c8b6d498_3e66ab8a",
        "filename": "src/dawn/native/CommandEncoder.cpp",
        "patchSetId": 11
      },
      "lineNbr": 195,
      "author": {
        "id": 1000030
      },
      "writtenOn": "2023-11-22T09:37:42Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "8ef0254d_8a17b108",
      "revId": "32a6a867b6015502e011694997da8d4e18f8986b",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6cf344a9_9e19f5e4",
        "filename": "src/dawn/native/CommandEncoder.cpp",
        "patchSetId": 11
      },
      "lineNbr": 476,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-11-20T13:48:35Z",
      "side": 1,
      "message": "The spec isn\u0027t super clear as to what attachments are considered [here](https://gpuweb.github.io/gpuweb/#dom-gpucommandencoder-beginrenderpass:~:text\u003dThe%20set%20of%20attachments%20in%20descriptor.colorAttachments%20must%20be%20pairwise%20disjoint.%20That%20is%2C%20no%20two%20attachments%20may%20refer%20to%20the%20same%20region%2C%20as%20defined%20by%20the%20view%27s%20texture%20subresource%20range%20and%20(for%20%223d%22%20attachments)%20the%20attachment%E2%80%99s%20depthSlice.), can you open an issue? But I think we should consider `resolveTarget` as part of it because previously we would validate this in [2].\n\nSo we need to call AddAttachment for `resolveTarget`, which also lets us simplify `ValidateResolveTarget` a bit. We need to let `AddAttachment` know that this is a resolve target so we can skip the sampleCount validation. Also passing an `AttachmentType` enum that\u0027s `RenderAttachment|StorageAttachment|ResolveTarget|DepthStencilAttachment` lets us simplify GetAttachmentTypeStr.\n\nCan we also have a ResourceUsageValidationTest that would have found this issue? (it would need two resolve targets that are the same subresource in a BeginRenderPass)",
      "revId": "32a6a867b6015502e011694997da8d4e18f8986b",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3255f396_edf14838",
        "filename": "src/dawn/native/CommandEncoder.cpp",
        "patchSetId": 11
      },
      "lineNbr": 476,
      "author": {
        "id": 1000030
      },
      "writtenOn": "2023-11-22T02:37:02Z",
      "side": 1,
      "message": "Sure, I\u0027m still considerring how to add the render target to mRecords and return its type string in GetAttachmentTypeStr, so I didn\u0027t reply the comments and send for review.",
      "parentUuid": "6cf344a9_9e19f5e4",
      "revId": "32a6a867b6015502e011694997da8d4e18f8986b",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b8887c86_8adef9f7",
        "filename": "src/dawn/native/CommandEncoder.cpp",
        "patchSetId": 11
      },
      "lineNbr": 476,
      "author": {
        "id": 1000030
      },
      "writtenOn": "2023-11-22T08:51:59Z",
      "side": 1,
      "message": "\u003e Can we also have a ResourceUsageValidationTest that would have found this issue? (it would need two resolve targets that are the same subresource in a BeginRenderPass) \n\nWe validate them in RenderPassDescriptor, so I think we should add tests for resolve target to MSAARenderToSingleSampledRenderPassDescriptorValidationTest.\n\nAnd we should move the tests for same attachments used twice in ResourceUsageTrackingTest.TextureWithMultipleRenderAttachmentUsage to RenderPassDescriptorValidationTest, because we\u0027d removed the validation from PassResourceUsageTracker. \n\nResourceUsageTrackingTest.TextureWithMultipleRenderAttachmentUsage need to be updated to test a check point in compatible usage list (https://gpuweb.github.io/gpuweb/#compatible-usage-list):\n`U contains exactly one element: attachment.`\n\nCurrently we have StorageAttachment and RenderAttachment for testing. But a question here, if a subresource is used as both stroage and render in a pass, it will be validated in beginRenderPass(), it won\u0027t reach to usage compatible validation in Finish(). Do we still need the rule in compatible usage list.",
      "parentUuid": "3255f396_edf14838",
      "revId": "32a6a867b6015502e011694997da8d4e18f8986b",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "636361cd_de34263b",
        "filename": "src/dawn/native/CommandEncoder.cpp",
        "patchSetId": 11
      },
      "lineNbr": 476,
      "author": {
        "id": 1000030
      },
      "writtenOn": "2023-11-22T08:56:53Z",
      "side": 1,
      "message": "Or only check subresource overlaping for render attachments?",
      "parentUuid": "b8887c86_8adef9f7",
      "revId": "32a6a867b6015502e011694997da8d4e18f8986b",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ecb076f8_61299c05",
        "filename": "src/dawn/native/CommandEncoder.cpp",
        "patchSetId": 11
      },
      "lineNbr": 476,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-11-22T09:46:20Z",
      "side": 1,
      "message": "Sorry I didn\u0027t follow everything, but the test you added in the latest patchset looks good.",
      "parentUuid": "636361cd_de34263b",
      "revId": "32a6a867b6015502e011694997da8d4e18f8986b",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fe92f2b5_b682dfe0",
        "filename": "src/dawn/native/CommandEncoder.cpp",
        "patchSetId": 11
      },
      "lineNbr": 476,
      "author": {
        "id": 1000030
      },
      "writtenOn": "2023-11-22T15:16:47Z",
      "side": 1,
      "message": "In short, I want to move the test at https://source.chromium.org/chromium/chromium/src/+/main:third_party/dawn/src/dawn/tests/unittests/validation/ResourceUsageTrackingTests.cpp;l\u003d1077;bpv\u003d0;bpt\u003d1 to RenderPassDescriptorValidationTest.\n\nAnd, we also need to add a test in ResourceUsageTrackingTests to cover a subresource is used as both render attachment and storage attachment. But it seems to already exist at https://source.chromium.org/chromium/chromium/src/+/main:third_party/dawn/src/dawn/tests/unittests/validation/PixelLocalStorageTests.cpp;l\u003d716?q\u003dStorageAtt\u0026ss\u003dchromium%2Fchromium%2Fsrc:third_party%2Fdawn%2Fsrc%2Fdawn%2F",
      "parentUuid": "ecb076f8_61299c05",
      "revId": "32a6a867b6015502e011694997da8d4e18f8986b",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e9c676ca_31c71ad1",
        "filename": "src/dawn/native/CommandEncoder.cpp",
        "patchSetId": 11
      },
      "lineNbr": 476,
      "author": {
        "id": 1000030
      },
      "writtenOn": "2023-11-23T05:07:28Z",
      "side": 1,
      "message": "I will land this CL, and move the tests in another CL if we need.",
      "parentUuid": "fe92f2b5_b682dfe0",
      "revId": "32a6a867b6015502e011694997da8d4e18f8986b",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "93d02a11_75a14374",
        "filename": "src/dawn/native/CommandEncoder.cpp",
        "patchSetId": 11
      },
      "lineNbr": 603,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-11-20T13:48:35Z",
      "side": 1,
      "message": "nit: commented out code? I think it can be removed.",
      "revId": "32a6a867b6015502e011694997da8d4e18f8986b",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "40d473f4_3bcab30c",
        "filename": "src/dawn/native/CommandEncoder.cpp",
        "patchSetId": 11
      },
      "lineNbr": 603,
      "author": {
        "id": 1000030
      },
      "writtenOn": "2023-11-22T02:37:02Z",
      "side": 1,
      "message": "It need to be removed, missed that.",
      "parentUuid": "93d02a11_75a14374",
      "revId": "32a6a867b6015502e011694997da8d4e18f8986b",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5b12e369_f17e39ee",
        "filename": "src/dawn/native/CommandEncoder.cpp",
        "patchSetId": 11
      },
      "lineNbr": 603,
      "author": {
        "id": 1000030
      },
      "writtenOn": "2023-11-22T09:37:42Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "40d473f4_3bcab30c",
      "revId": "32a6a867b6015502e011694997da8d4e18f8986b",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "befe835d_27c1bbee",
        "filename": "src/dawn/native/CommandEncoder.cpp",
        "patchSetId": 11
      },
      "lineNbr": 1130,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2023-11-20T13:48:35Z",
      "side": 1,
      "message": "[2]",
      "revId": "32a6a867b6015502e011694997da8d4e18f8986b",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    }
  ]
}