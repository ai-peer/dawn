{
  "comments": [
    {
      "key": {
        "uuid": "c16f9777_9a946fa0",
        "filename": "src/dawn_native/d3d12/TextureD3D12.cpp",
        "patchSetId": 5
      },
      "lineNbr": 195,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2018-10-24T09:25:49Z",
      "side": 1,
      "message": "I think it should depend on the dimension of the texture view instead because if we have a cube texture view, then we need to use D3D12_TEXCUBE_SRV instead.",
      "range": {
        "startLine": 195,
        "startChar": 11,
        "endLine": 195,
        "endChar": 82
      },
      "revId": "ce9ae0b5d382b885602ef5035d6f757c8f8d74de",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "65fa402a_2ae1646e",
        "filename": "src/dawn_native/d3d12/TextureD3D12.cpp",
        "patchSetId": 5
      },
      "lineNbr": 195,
      "author": {
        "id": 1000019
      },
      "writtenOn": "2018-10-25T00:55:15Z",
      "side": 1,
      "message": "I find this issue when I am trying to create a 2D texture view on a layer of a 2D array texture. From the definition of D3D12_TEX2D_SRV you can see we cannot specify the base layer and array count in this structure:\nhttps://docs.microsoft.com/en-us/windows/desktop/api/d3d12/ns-d3d12-d3d12_tex2d_srv\n\nIf we want to specify a 2D texture view on a layer of a 2D array texture with layer \u003e 0, we can only use D3D12_TEX2D_ARRAY_SRV, where we can set FirstArraySlice and ArraySize.\nhttps://docs.microsoft.com/en-us/windows/desktop/api/d3d12/ns-d3d12-d3d12_tex2d_array_srv\n\nIt is also true for cube maps as we cannot specify the base layer in D3D12_TEXCUBE_SRV:\nhttps://docs.microsoft.com/en-us/windows/desktop/api/d3d12/ns-d3d12-d3d12_texcube_srv\n\nIn fact I find we can always use D3D12_TEX2D_ARRAY_SRV here and never using D3D12_TEX2D_SRV. In this case we just treat a 2D texture as a 1-layer 2D texture array. All the tests and examples can work when we always use D3D12_TEX2D_ARRAY_SRV.",
      "parentUuid": "c16f9777_9a946fa0",
      "range": {
        "startLine": 195,
        "startChar": 11,
        "endLine": 195,
        "endChar": 82
      },
      "revId": "ce9ae0b5d382b885602ef5035d6f757c8f8d74de",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ed049518_8b0afc6d",
        "filename": "src/dawn_native/d3d12/TextureD3D12.cpp",
        "patchSetId": 5
      },
      "lineNbr": 195,
      "author": {
        "id": 1000015
      },
      "writtenOn": "2018-10-25T01:37:33Z",
      "side": 1,
      "message": "I think this SGTM.",
      "parentUuid": "65fa402a_2ae1646e",
      "range": {
        "startLine": 195,
        "startChar": 11,
        "endLine": 195,
        "endChar": 82
      },
      "revId": "ce9ae0b5d382b885602ef5035d6f757c8f8d74de",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "84234e3e_b3753a6d",
        "filename": "src/dawn_native/d3d12/TextureD3D12.cpp",
        "patchSetId": 5
      },
      "lineNbr": 195,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2018-10-25T10:34:28Z",
      "side": 1,
      "message": "Thanks for the explanation, always treating as 2D/Cube array potentially of size 1 SGTM too. I remember Rafael saying it shouldn\u0027t be worse in term of performance and we can always revisit later.\n\nCan you update the comment to explain the problem and the solution for future us?",
      "parentUuid": "ed049518_8b0afc6d",
      "range": {
        "startLine": 195,
        "startChar": 11,
        "endLine": 195,
        "endChar": 82
      },
      "revId": "ce9ae0b5d382b885602ef5035d6f757c8f8d74de",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a5e4fdbd_f5ceb9f0",
        "filename": "src/dawn_native/d3d12/TextureD3D12.cpp",
        "patchSetId": 5
      },
      "lineNbr": 204,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2018-10-24T09:25:49Z",
      "side": 1,
      "message": "This check would be covered by a switch on the the texture view dimension instead.",
      "range": {
        "startLine": 204,
        "startChar": 16,
        "endLine": 204,
        "endChar": 58
      },
      "revId": "ce9ae0b5d382b885602ef5035d6f757c8f8d74de",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "33591005_78757d7c",
        "filename": "src/dawn_native/metal/TextureMTL.mm",
        "patchSetId": 5
      },
      "lineNbr": 58,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2018-10-24T09:25:49Z",
      "side": 1,
      "message": "note: I think we can add this only for dawn::TextureUsageBit::Sampled and Storage but it is not needed for render targets. You don\u0027t need to make changes for that right now but it could be an optimization later.",
      "revId": "ce9ae0b5d382b885602ef5035d6f757c8f8d74de",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1f4f5800_6173dfcc",
        "filename": "src/dawn_native/metal/TextureMTL.mm",
        "patchSetId": 5
      },
      "lineNbr": 58,
      "author": {
        "id": 1000019
      },
      "writtenOn": "2018-10-25T00:55:15Z",
      "side": 1,
      "message": "I think we still need this flag if we want to render into a layer of this texture.",
      "parentUuid": "33591005_78757d7c",
      "revId": "ce9ae0b5d382b885602ef5035d6f757c8f8d74de",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "edbaed22_3598d79b",
        "filename": "src/dawn_native/metal/TextureMTL.mm",
        "patchSetId": 5
      },
      "lineNbr": 58,
      "author": {
        "id": 1000015
      },
      "writtenOn": "2018-10-25T01:37:33Z",
      "side": 1,
      "message": "I think that depends on whether WebGPU allows rendering into TextureViews (I\u0027m not sure off the top of my head). Metal probably allows it, but it also has a slice parameter in MTLRenderPassAttachmentDescriptor: https://developer.apple.com/documentation/metal/mtlrenderpassattachmentdescriptor?language\u003dobjc\n\nIn any case, it\u0027s probably better to be \"optimistic\" now and restrict usage of this flag as much as possible, and turn it on later if it turns out to be needed.",
      "parentUuid": "1f4f5800_6173dfcc",
      "revId": "ce9ae0b5d382b885602ef5035d6f757c8f8d74de",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1dcc6bb3_cf339731",
        "filename": "src/dawn_native/metal/TextureMTL.mm",
        "patchSetId": 5
      },
      "lineNbr": 58,
      "author": {
        "id": 1000019
      },
      "writtenOn": "2018-10-25T05:59:54Z",
      "side": 1,
      "message": "Ack\nIn this patch we have to always set this flag because we always call newTextureViewWithPixelFormat when creating a texture view, and without this flag we cannot call this function:\nhttps://developer.apple.com/documentation/metal/mtltextureusage/mtltextureusagepixelformatview?language\u003dobjc\nI just add a TODO here to see if we can skip creating the texture view when it is only used as a render target.",
      "parentUuid": "edbaed22_3598d79b",
      "revId": "ce9ae0b5d382b885602ef5035d6f757c8f8d74de",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f28a597e_871492a4",
        "filename": "src/dawn_native/metal/TextureMTL.mm",
        "patchSetId": 5
      },
      "lineNbr": 58,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2018-10-25T10:34:28Z",
      "side": 1,
      "message": "SGTM",
      "parentUuid": "1dcc6bb3_cf339731",
      "revId": "ce9ae0b5d382b885602ef5035d6f757c8f8d74de",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "22528672_465b3876",
        "filename": "src/dawn_native/metal/TextureMTL.mm",
        "patchSetId": 5
      },
      "lineNbr": 120,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2018-10-24T09:25:49Z",
      "side": 1,
      "message": "nit: Can we have a TODO to not create a texture view when it is the exact same as the full texture?",
      "revId": "ce9ae0b5d382b885602ef5035d6f757c8f8d74de",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "78df5338_2bfe9db6",
        "filename": "src/dawn_native/metal/TextureMTL.mm",
        "patchSetId": 5
      },
      "lineNbr": 120,
      "author": {
        "id": 1000019
      },
      "writtenOn": "2018-10-25T00:55:15Z",
      "side": 1,
      "message": "I suggest when the texture view is created by CreateDefaultTextureView(), we can pass a null descriptor or some other flags into here, then we can know we can directly use the original texture without creating a texture view.",
      "parentUuid": "22528672_465b3876",
      "revId": "ce9ae0b5d382b885602ef5035d6f757c8f8d74de",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "111bbd95_6b759dfe",
        "filename": "src/dawn_native/metal/TextureMTL.mm",
        "patchSetId": 5
      },
      "lineNbr": 120,
      "author": {
        "id": 1000015
      },
      "writtenOn": "2018-10-25T01:37:33Z",
      "side": 1,
      "message": "Could you add a TODO that suggests both possible implementations? I still don\u0027t think we need to add it right now.",
      "parentUuid": "78df5338_2bfe9db6",
      "revId": "ce9ae0b5d382b885602ef5035d6f757c8f8d74de",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1cdef137_95f154be",
        "filename": "src/dawn_native/metal/TextureMTL.mm",
        "patchSetId": 5
      },
      "lineNbr": 120,
      "author": {
        "id": 1000019
      },
      "writtenOn": "2018-10-25T05:59:54Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "111bbd95_6b759dfe",
      "revId": "ce9ae0b5d382b885602ef5035d6f757c8f8d74de",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd",
      "unresolved": false
    }
  ]
}