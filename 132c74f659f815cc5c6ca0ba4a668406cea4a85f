{
  "comments": [
    {
      "key": {
        "uuid": "e920328a_5231cef0",
        "filename": "src/dawn_native/vulkan/DeviceVk.cpp",
        "patchSetId": 4
      },
      "lineNbr": 679,
      "author": {
        "id": 1000032
      },
      "writtenOn": "2019-11-19T22:22:08Z",
      "side": 1,
      "message": "If CreateFromExternal succeeds, but ImportExternalImage or BindExternalMemory fail, then the Texture is leaked.\n\nTwo possibilities:\n1) If we can move the logic in ImportExternalImage into InitializeFromExternal, then BindExternalMemory could stay inlined in IntitializeFromExternal as well. We\u0027d have to pass in \u0026mExternalMemoryService and \u0026mExternalSemaphoreService into CreateFromExternal\n\n2) if (result !\u003d nullptr) { delete result; }\n\nI slightly prefer (1) because BindExternalMemory and ImportExternalImage should probably never be used except with CreateFromExternal.\n\nWhat do you think?",
      "range": {
        "startLine": 675,
        "startChar": 12,
        "endLine": 679,
        "endChar": 81
      },
      "revId": "132c74f659f815cc5c6ca0ba4a668406cea4a85f",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "817c0635_a6b980e9",
        "filename": "src/dawn_native/vulkan/DeviceVk.cpp",
        "patchSetId": 4
      },
      "lineNbr": 679,
      "author": {
        "id": 1000505
      },
      "writtenOn": "2019-11-20T01:18:50Z",
      "side": 1,
      "message": "I started implementing (1), but it started to get pretty involved with all of the extra params I\u0027d now have to pass to CreateFromExternal. In addition to the MemoryService and the SemaphoreService, I\u0027ll also need to pass in waitHandles/memoryHandle. Furthermore, if we\u0027re going to do this change to ensure the texture is cleaned up inside CreateFromExternal on failure, we\u0027re going to want to move the current failure code down below (semaphore and memory cleanup) into CreateFromExternal as well for consistency.\n\nI agree that (1) would be nicer, but I\u0027m just going to do (2) for now. This will be a nontrivial refactor, and I don\u0027t want too many merge conflicts with myself in this chain of CLs. I assigned http://crbug.com/1026480 to myself to clean this up once my CLs are all in.",
      "parentUuid": "e920328a_5231cef0",
      "range": {
        "startLine": 675,
        "startChar": 12,
        "endLine": 679,
        "endChar": 81
      },
      "revId": "132c74f659f815cc5c6ca0ba4a668406cea4a85f",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bc4e1c6a_52366194",
        "filename": "src/dawn_native/vulkan/DeviceVk.cpp",
        "patchSetId": 4
      },
      "lineNbr": 679,
      "author": {
        "id": 1000032
      },
      "writtenOn": "2019-11-20T01:23:30Z",
      "side": 1,
      "message": "Okay, sounds good to clean this up later.",
      "parentUuid": "817c0635_a6b980e9",
      "range": {
        "startLine": 675,
        "startChar": 12,
        "endLine": 679,
        "endChar": 81
      },
      "revId": "132c74f659f815cc5c6ca0ba4a668406cea4a85f",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd",
      "unresolved": false
    }
  ]
}