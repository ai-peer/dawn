{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "6e9728bc_5d0d92c2",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 11,
      "author": {
        "id": 1002831
      },
      "writtenOn": "2022-05-19T00:15:03Z",
      "side": 1,
      "message": "nit. or",
      "range": {
        "startLine": 11,
        "startChar": 8,
        "endLine": 11,
        "endChar": 11
      },
      "revId": "facc06373d08e07f4d2ff9221c5b21ce55ea75a2",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "29eaf5a0_166ba388",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 11,
      "author": {
        "id": 1000032
      },
      "writtenOn": "2022-05-19T16:17:21Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6e9728bc_5d0d92c2",
      "range": {
        "startLine": 11,
        "startChar": 8,
        "endLine": 11,
        "endChar": 11
      },
      "revId": "facc06373d08e07f4d2ff9221c5b21ce55ea75a2",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "54b0985d_c6422b42",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1002831
      },
      "writtenOn": "2022-05-19T00:15:03Z",
      "side": 1,
      "message": "Hmm ok took me a while to try to understand this... IIUC though, this only solves the cycle at the external level right? I assume that right now, externally created objects call device.APIReference(), so we are using that to make sure that as long as an external object lives, we don\u0027t call destroy, and the device lives.\n\nFor native though, I think that objects still cannot outlive the device right? Since the external counter will be 1 and assuming native doesn\u0027t call APIReference anywhere when each object is made, as soon as the device goes away, all objects will be destroyed.\n\nI\u0027m thinking whether it would be possible to expose something in ObjectBase like `DropDeviceRef` or `WeakDeviceRef` and call those on the objects that are cached by the device instead? (Presumably that would cause the Ref to decrement or something so the internally cached objects wouldn\u0027t keep the device alive.) Then I think both native and external wouldn\u0027t have the ref cycles? Could also be a template wrapper around the Refs\u003cObjectBase\u003e in the device? Not entirely sure that would work yet, but just throwing my thoughts here.",
      "revId": "facc06373d08e07f4d2ff9221c5b21ce55ea75a2",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b4dd8134_4f61a951",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000032
      },
      "writtenOn": "2022-05-19T00:33:55Z",
      "side": 1,
      "message": "Native does call APIReference/Release\nhttps://source.chromium.org/chromium/chromium/src/+/main:out/Debug/gen/third_party/dawn/src/dawn/native/ProcTable.cpp;l\u003d746?q\u003dAPIReference%20f:dawn\u0026ss\u003dchromium%2Fchromium%2Fsrc\n\nNot sure what you mean by native/external. Native users of the WebGPU API still will go through API* functions so they are external. If you mean native and internal to Dawn, then yea - objects still cannot outlive the device. That\u0027s why they all hold Ref\u003cDeviceBase\u003e now instead of a raw DeviceBase*\n\nre DropDeviceRef / WeakDeviceRef:\nYea, I think we could do something like that - though it would need to do it recursively. Some of those objects are containers for other objects.",
      "parentUuid": "54b0985d_c6422b42",
      "revId": "facc06373d08e07f4d2ff9221c5b21ce55ea75a2",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "610f3f34_03eacd07",
        "filename": "src/dawn/native/Device.cpp",
        "patchSetId": 5
      },
      "lineNbr": 300,
      "author": {
        "id": 1002831
      },
      "writtenOn": "2022-05-19T00:15:03Z",
      "side": 1,
      "message": "nit. hold",
      "range": {
        "startLine": 300,
        "startChar": 65,
        "endLine": 300,
        "endChar": 73
      },
      "revId": "facc06373d08e07f4d2ff9221c5b21ce55ea75a2",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "17e4ef6c_87fcafeb",
        "filename": "src/dawn/native/Device.cpp",
        "patchSetId": 5
      },
      "lineNbr": 300,
      "author": {
        "id": 1000032
      },
      "writtenOn": "2022-05-19T16:17:21Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "610f3f34_03eacd07",
      "range": {
        "startLine": 300,
        "startChar": 65,
        "endLine": 300,
        "endChar": 73
      },
      "revId": "facc06373d08e07f4d2ff9221c5b21ce55ea75a2",
      "serverId": "dd02978d-1a8e-36d7-bcc0-a5723e5c0abd"
    }
  ]
}